<script>
async function loadSite() {
  try {
    const res = await fetch('site-data.json?v=' + Date.now());
    const data = await res.json();

    // ABOUT
    document.getElementById('aboutText').textContent = data.about || '';

    // SKILLS
    const skillsDiv = document.getElementById('skills');
    skillsDiv.innerHTML = (data.skills || [])
      .map(skill => `<span class="skill">${skill}</span>`)
      .join('');

    // EXPERIENCE
    const expDiv = document.getElementById('experienceTimeline');
    expDiv.innerHTML = (data.experience || [])
      .map(exp => `
        <div class="timeline-item">
          <h3>${exp.title || ''}</h3>
          <div class="company">${exp.company || ''}</div>
          <div class="duration">${exp.duration || ''}</div>
          ${exp.description ? `<div class="description">${exp.description}</div>` : ''}
        </div>
      `)
      .join('');

    // EDUCATION
    const eduDiv = document.getElementById('educationTimeline');
    eduDiv.innerHTML = (data.education || [])
      .map(edu => `
        <div class="timeline-item">
          <h3>${edu.degree || ''}</h3>
          <div class="company">${edu.institution || ''}</div>
          <div class="duration">${edu.year || ''}</div>
          ${edu.description ? `<div class="description">${edu.description}</div>` : ''}
        </div>
      `)
      .join('');

    // âœ… PROJECTS (auto path detection for root or Projects folder)
    const projDiv = document.getElementById('projectsGrid');
    projDiv.innerHTML = (data.projects || [])
      .map(p => {
        let pdfPath = p.pdfUrl || '';
        // detect if pdf is inside Projects or root
        if (!pdfPath.includes('/')) {
          // Try root first
          pdfPath = `${pdfPath}`;
        }
        return `
        <div class="project-item">
          <h3>${p.title || p.pdfUrl}</h3>
          ${p.description ? `<p>${p.description}</p>` : ''}
          ${
            p.pdfUrl
              ? `<iframe class="project-frame" src="${pdfPath}#toolbar=0&navpanes=0" 
                   title="${p.title || 'Project PDF Preview'}" onerror="this.style.display='none'"></iframe>`
              : ''
          }
          ${
            p.pdfUrl
              ? `<p style="margin-top:12px"><a href="${pdfPath}" target="_blank" class="btn">ðŸ“„ View Full PDF</a></p>`
              : ''
          }
          ${
            p.link
              ? `<p style="margin-top:8px"><a href="${p.link}" target="_blank" class="btn">ðŸ”— Open Project</a></p>`
              : ''
          }
        </div>
      `;
      })
      .join('');

    // BLOGS
    const blogs = (data.blogs || [])
      .filter(b => !/resume/i.test(b.title || ""))
      .sort((a, b) => new Date(b.date) - new Date(a.date));

    const blogDiv = document.getElementById('blogCarousel');
    blogDiv.innerHTML = blogs
      .map(blog => `
        <div class="blog-card" onclick="openBlog(${JSON.stringify(blog).replace(/"/g, '&quot;')})">
          ${
            blog.image
              ? `<div class="blog-card-image"><img src="${blog.image}" alt="${blog.title}"></div>`
              : ''
          }
          <div class="blog-card-content">
            <h3>${blog.title}</h3>
            <div class="date">${blog.date || ''}</div>
            <div class="excerpt">${blog.subheading || ''}</div>
          </div>
        </div>
      `)
      .join('');

    // RESUME
    document.getElementById('resumeLink').href = data.resumeUrl || 'resume.pdf';

    // CONTACT
    if (data.contactEmail) {
      document.getElementById('contactEmail').textContent = data.contactEmail;
      document.getElementById('contactEmail').href = `mailto:${data.contactEmail}`;
    }
  } catch (err) {
    console.error("Error loading JSON:", err);
    document.getElementById('aboutText').textContent =
      "Error loading site-data.json. Check file path or syntax.";
  }
}

function openBlog(blog) {
  document.getElementById('mainPage').style.display = 'none';
  document.getElementById('blogPage').classList.add('active');
  document.getElementById('blogTitle').textContent = blog.title || '';
  document.getElementById('blogSubheading').textContent = blog.subheading || '';
  document.getElementById('blogMeta').textContent = blog.date || '';
  document.getElementById('blogBody').innerHTML = `
    ${blog.image ? `<figure class="blog-image"><img src="${blog.image}" alt=""><figcaption>${blog.imageCaption || ''}</figcaption></figure>` : ''}
    <p>${(blog.content || '').replace(/\n/g, '</p><p>')}</p>
  `;
}

function closeBlog() {
  document.getElementById('blogPage').classList.remove('active');
  document.getElementById('mainPage').style.display = '';
}

function scrollCarousel(dir) {
  document.getElementById('blogCarousel').scrollBy({
    left: dir * 400,
    behavior: 'smooth'
  });
}

loadSite();
</script>
